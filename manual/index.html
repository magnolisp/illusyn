<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>Illusyn</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="autobib.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Illusyn</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Concrete_.A.S.T_.Node_.Types%29" class="tocviewlink" data-pltdoc="x">Concrete AST Node Types</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._views%29" class="tocviewlink" data-pltdoc="x">AST Node Abstract Interfaces</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.A.S.T_.Serialization%29" class="tocviewlink" data-pltdoc="x">AST Serialization</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._.Traversing_and_.Rewriting%29" class="tocviewlink" data-pltdoc="x">Traversing and Rewriting</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="#%28part._.Examples%29" class="tocviewlink" data-pltdoc="x">Examples</a></td></tr><tr><td align="right"></td><td><a href="#%28part._doc-bibliography%29" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.Illusyn%29" class="tocsubseclink" data-pltdoc="x">Illusyn</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Concrete_.A.S.T_.Node_.Types%29" class="tocsubseclink" data-pltdoc="x">Concrete AST Node Types</a></td></tr><tr><td><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>ast</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%2A%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>ast*</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._.View_.Structure%29" class="tocsubseclink" data-pltdoc="x">View Structure</a></td></tr><tr><td><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._make-view-all%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">make-<wbr></wbr>view-<wbr></wbr>all</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._make-view-some%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">make-<wbr></wbr>view-<wbr></wbr>some</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._make-view-one%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">make-<wbr></wbr>view-<wbr></wbr>one</span></span></a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._views%29" class="tocsubseclink" data-pltdoc="x">AST Node Abstract Interfaces</a></td></tr><tr><td><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>view</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%2A%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>view*</span></span></a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.A.S.T_.Serialization%29" class="tocsubseclink" data-pltdoc="x">AST Serialization</a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fast-serialize..rkt%29._gen~3asyntactifiable%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gen:<span class="mywbr"> &nbsp;</span>syntactifiable</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fast-serialize..rkt%29._syntactifiable~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">syntactifiable?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fast-serialize..rkt%29._syntactifiable-mkstx%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">syntactifiable-<wbr></wbr>mkstx</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.Traversing_and_.Rewriting%29" class="tocsubseclink" data-pltdoc="x">Traversing and Rewriting</a></td></tr><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._.Abstraction_over_.Concrete_.Term_.Specifics%29" class="tocsubseclink" data-pltdoc="x">Abstraction over Concrete Term Specifics</a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._gen~3astrategic%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gen:<span class="mywbr"> &nbsp;</span>strategic</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">strategic?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._term-visit-all%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">term-<wbr></wbr>visit-<wbr></wbr>all</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._term-rewrite-all%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">term-<wbr></wbr>rewrite-<wbr></wbr>all</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._term-fields%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">term-<wbr></wbr>fields</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._set-term-fields%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">set-<wbr></wbr>term-<wbr></wbr>fields</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4.1.1<tt>&nbsp;</tt></span><a href="#%28part._.Lenses%29" class="tocsubseclink" data-pltdoc="x">Lenses</a></td></tr><tr><td><span class="tocsublinknumber">4.2<tt>&nbsp;</tt></span><a href="#%28part._.Visits%29" class="tocsubseclink" data-pltdoc="x">Visits</a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._all-visitor%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">all-<wbr></wbr>visitor</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._topdown-visitor%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">topdown-<wbr></wbr>visitor</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._bottomup-visitor%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">bottomup-<wbr></wbr>visitor</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4.3<tt>&nbsp;</tt></span><a href="#%28part._.Rewriting_.Strategies%29" class="tocsubseclink" data-pltdoc="x">Rewriting Strategies</a></td></tr><tr><td><span class="tocsublinknumber">4.3.1<tt>&nbsp;</tt></span><a href="#%28part._.Primitive_.Strategies%29" class="tocsubseclink" data-pltdoc="x">Primitive Strategies</a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._fail-rw%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">fail-<wbr></wbr>rw</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._id-rw%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">id-<wbr></wbr>rw</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4.3.2<tt>&nbsp;</tt></span><a href="#%28part._all-some-one%29" class="tocsubseclink" data-pltdoc="x">Primitive Strategy Combinators</a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._all%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">all</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._some%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">some</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._one%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">one</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4.3.3<tt>&nbsp;</tt></span><a href="#%28part._.High-.Level_.Strategy_.Combinators%29" class="tocsubseclink" data-pltdoc="x">High-<wbr></wbr>Level Strategy Combinators</a></td></tr><tr><td><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._~3c%2A%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">&lt;*</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._~3c%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">&lt;+</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._rec%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">rec</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._try%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">try</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._where%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">where</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._when-rw%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">when-<wbr></wbr>rw</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._repeat%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">repeat</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._topdown%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">topdown</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._bottomup%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">bottomup</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._downup%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">downup</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._oncetd%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">oncetd</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4.4<tt>&nbsp;</tt></span><a href="#%28part._.Sub-.Term_.Pruning_.Strategies%29" class="tocsubseclink" data-pltdoc="x">Sub-<wbr></wbr>Term Pruning Strategies</a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._topdown-break%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">topdown-<wbr></wbr>break</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._topdown-visit-break%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">topdown-<wbr></wbr>visit-<wbr></wbr>break</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._break%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">break</span></span></a></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#%28part._.Examples%29" class="tocsubseclink" data-pltdoc="x">Examples</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._doc-bibliography%29" class="tocsubseclink" data-pltdoc="x">Bibliography</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">6.4</span></div><h2><a name="(part._.Illusyn)"></a>Illusyn</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Tero Hasu</p></span></div><p><a name="(tech._illusyn)"></a><span style="font-style: italic">Illusyn</span> (Illusionary Syntax) is a <a href="http://racket-lang.org/">Racket</a>-based library. It supports declarative definition of <span style="font-style: italic">abstract syntax trees</span> (ASTs) for purposes of program transformation. Both the programming interface as well as the implementation of the interface gets generated from declarative specifications. As a form of abstraction, it is possible to declare multiple interfaces per AST node type, with each interface also exposing the &ldquo;structure&rdquo; of its data.</p><p>The library also includes operations for transforming and serializing AST
nodes. Transformations may be implemented either using Racket&rsquo;s native functionality (e.g., <span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span> for pattern matching), or through Illusyn&rsquo;s support for <span style="font-style: italic">strategic pattern matching</span>&nbsp;(<a href="#%28autobib._.Eelco._.Visser.Strategic._.Pattern._.Matching.In._.Proc..._.Rewriting._.Techniques._and._.Applications._%28.R.T.A%2799%29%2C._pp..._30--441999%29" data-pltdoc="x">Visser</a> <a href="#%28autobib._.Eelco._.Visser.Strategic._.Pattern._.Matching.In._.Proc..._.Rewriting._.Techniques._and._.Applications._%28.R.T.A%2799%29%2C._pp..._30--441999%29" data-pltdoc="x">1999</a>).</p><h3>1<tt>&nbsp;</tt><a name="(part._.Concrete_.A.S.T_.Node_.Types)"></a><a name="(mod-path._magnolisp/ast-repr)"></a>Concrete AST Node Types</h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._magnolisp%2Fast-repr%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">magnolisp/ast-repr</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <span class="stt">magnolisp</span></span></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._magnolisp/ast-repr..rkt)._define-ast))"></a><span title="Provided from: magnolisp/ast-repr | Package: magnolisp"><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-ast</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">id</span><span class="hspace">&nbsp;</span><span class="RktVar">views</span><span class="hspace">&nbsp;</span><span class="RktVar">fields</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-opts</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">views</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">cview</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">cview</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">view-id</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">view-id</span><span class="hspace">&nbsp;</span><span class="RktVar">cview-spec</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">cview-spec</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">field-spec</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="hspace">&nbsp;</span><span class="RktVar">cview-opt</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktPn">#:fields</span><span class="hspace">&nbsp;</span><span class="RktVar">field-name</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="hspace">&nbsp;</span><span class="RktVar">cview-opt</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">cview-opt</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:copy</span><span class="hspace">&nbsp;</span><span class="RktVar">copier-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:predicate</span><span class="hspace">&nbsp;</span><span class="RktVar">predicate-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">fields</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">field</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">field</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktPn">#:none</span><span class="hspace">&nbsp;</span><span class="RktVar">field-name</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktPn">#:maybe</span><span class="hspace">&nbsp;</span><span class="RktVar">field-name</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktPn">#:just</span><span class="hspace">&nbsp;</span><span class="RktVar">field-name</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktPn">#:many</span><span class="hspace">&nbsp;</span><span class="RktVar">field-name</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">maybe-opts</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktVar">maybe-singleton</span></td></tr><tr><td><span class="RktVar">maybe-custom-write</span></td></tr><tr><td><span class="RktVar">maybe-struct-options</span></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">maybe-singleton</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:singleton</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">arg-expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">maybe-custom-write</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:custom-write</span><span class="hspace">&nbsp;</span><span class="RktVar">writer-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">maybe-struct-options</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:struct-options</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">struct-opt-datum</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Defines a new AST node type named <span class="RktVar">id</span>.</div></p><p>Defining a node type involves also defining a new, underlying structure type
named <span class="RktVar">id</span>. The defined type has no supertypes, but it is possible to
specify a set of <span class="RktVar">views</span> that the new type should implement; each
<span class="RktVar">view-id</span> should name a view defined using <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%29%29" class="RktStxLink" data-pltdoc="x">define-view</a></span>.</p><p>The structure type will have a field for each specified <span class="RktVar">field-name</span>. Each <span class="RktVar">field</span> specification should also include one of the term quantity modifiers
<span class="RktPn">#:none</span>, <span class="RktPn">#:maybe</span>, <span class="RktPn">#:just</span>, or <span class="RktPn">#:many</span> to indicate the desired behavior during strategic term rewriting. Any field tagged with <span class="RktPn">#:none</span> is not traversed into during a rewrite. Any value of a <span class="RktPn">#:just</span> field is treated as a single term to be traversed. Any value of a <span class="RktPn">#:maybe</span> field is traversed and treated as a term unless it is <span class="RktVal">#f</span>. Any <span class="RktPn">#:many</span> field value is assumed to be a list whose elements are terms to be traversed.</p><p>The <span class="RktPn">#:singleton</span> option modifies the behavior of <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span> so that an <span style="font-style: italic">instance</span> of the structure gets bound under the name <span class="RktSym">the-</span><span class="RktVar">id</span>, where the instance is created by calling the constructor using the arguments specified by <span class="RktPn">(</span><span class="RktVar">arg-expr</span><span class="stt"> </span><span class="RktMeta"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span>. This option does <span style="font-style: italic">not</span> in any way modify the way that <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span> defines the affected AST node type itself, or associated operations. In particular, all the usual operations for creating other copies of the &ldquo;singleton&rdquo; object are available.</p><p>By default, each AST node type will implement the <span class="RktSym"><a href="http://docs.racket-lang.org/reference/Printer_Extension.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._gen~3acustom-write%29%29" class="RktValLink" data-pltdoc="x">gen:custom-write</a></span> interface such that the <span class="RktSym">write-proc</span> method will <span style="font-style: italic">not</span> print the contents of any field named <span class="RktSym">annos</span>. To modify the default behavior, use the <span class="RktPn">#:custom-write</span> option to specify a different <span class="RktSym">write-proc</span> implementation. The <span class="RktVar">writer-expr</span> should be an expression that specifies a suitable function; see <span class="RktSym"><a href="http://docs.racket-lang.org/reference/Printer_Extension.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._gen~3acustom-write%29%29" class="RktValLink" data-pltdoc="x">gen:custom-write</a></span> documentation for further information about what said function must be like.</p><p>The defined structure type is always marked <span class="RktPn">#:transparent</span>, to allow for run-time introspection. Additional <span class="RktSym"><a href="http://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" class="RktStxLink" data-pltdoc="x">struct</a></span> options may be specified; each <span class="RktVar">struct-opt-datum</span> given is passed directly onto <span class="RktSym"><a href="http://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" class="RktStxLink" data-pltdoc="x">struct</a></span>.</p><p><div class="SIntrapara">The following interfaces and operations are implemented for AST node types:
</div><div class="SIntrapara"><ul><li><p>Each type has the operations usually associated with immutable structure types. For example, each type <span class="RktVar">id</span> gets: a membership predicate <span class="RktVar">id</span><span class="RktSym">?</span>; a constructor <span class="RktVar">id</span>, and a getter <span class="RktVar">id</span><span class="RktSym">-</span><span class="RktVar">field-name</span> for each of its fields. Racket&rsquo;s <span class="RktSym"><a href="http://docs.racket-lang.org/reference/struct-copy.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct-copy%29%29" class="RktStxLink" data-pltdoc="x">struct-copy</a></span> and <span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span> constructs also cooperate with the structure definition.</p></li><li><p>Each type implements the <span class="RktSym"><a href="http://docs.racket-lang.org/reference/Printer_Extension.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._gen~3acustom-write%29%29" class="RktValLink" data-pltdoc="x">gen:custom-write</a></span> interface, as explained above.</p></li><li><p>Each type implements the <span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._gen~3aequal%2Bhash%29%29" class="RktValLink" data-pltdoc="x">gen:equal+hash</a></span> interface. The implementation defines the meaning of <span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span> comparisons when instances of the type are involved; hashing functions are also defined. The <span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span> comparison is implemented by comparing the values of all fields with <span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span>, except that any field named <span class="RktSym">annos</span> is ignored.</p></li><li><p>Each type implements the <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fast-serialize..rkt%29._gen~3asyntactifiable%29%29" class="RktValLink" data-pltdoc="x">gen:syntactifiable</a></span> interface, thus defining how to serialize an instance of the type as Racket code.</p></li><li><p>Each type implements the <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._gen~3astrategic%29%29" class="RktValLink" data-pltdoc="x">gen:strategic</a></span> interface. This defines the node-type-specific functionality required to support the <a href="#%28mod-path._magnolisp%2Fstrategy-stratego%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">magnolisp/strategy-stratego</span></a> API. The <a href="#%28mod-path._magnolisp%2Fstrategy-stratego%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">magnolisp/strategy-stratego</span></a> module implements the primitive traversal combinators that it requires in terms of <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._gen~3astrategic%29%29" class="RktValLink" data-pltdoc="x">gen:strategic</a></span>. Said combinators are required as a basis for generic traversals over AST nodes.</p></li><li><p>Each type includes the structure type property <span class="RktSym">prop:</span><span class="RktVar">view-id</span> for each of the <span class="RktVar">views</span> it supports. The value of the property is set to contain type-specific implementations of the primitive view operations, to which the generic view functions dispatch dynamically as appropriate. If no overriding implementation is specified as <span class="RktVar">cview-spec</span>, then the default implementations of the operations (as specified for the view) are generated. See <a href="#%28mod-path._magnolisp%2Fast-view%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">magnolisp/ast-view</span></a> for information on defining views, the operations associated with views, and the <span class="RktVar">field-spec</span> and <span class="RktVar">field-name</span> grammar rules.</p><p>The <span class="RktPn">#:copy</span> option is specific to <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span>, and may be used to specify a non-default <span class="RktSym">copy-</span><span class="RktVar">view-id</span> operation, with <span class="RktVar">copier-expr</span> being an expression that specifies a suitable function.</p><p>Similarly, the <span class="RktPn">#:predicate</span> option may be used to specify a <span class="RktVar">predicate-expr</span>, which must evaluate to a function accepting one argument. Any specified predicate is used for determining whether a given instance of <span class="RktVar">id</span> is a member of an associated <span class="RktVar">view-id</span>; in other words, the predicate determines the result of <span class="RktVar">view-id</span><span class="RktSym">?</span>, when applied to instances of <span class="RktVar">id</span>. The default behavior is for <span style="font-style: italic">all</span> instances of <span class="RktVar">id</span> to be members of any listed <span class="RktVar">view-id</span>. A <span class="RktPn">#:predicate</span> may only be specified for views declared with the <span class="RktPn">#:partial</span> attribute.</p></li><li><p>Each type <span class="RktVar">id</span> implements the comparison relation <span class="RktVar">id</span><span class="RktSym">=?</span>, for compatibility with views. For AST node types, this operation is like <span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span>, but with the additional requirement that both arguments must be of type <span class="RktVar">id</span>; otherwise an argument error is raised.</p></li><li><p>Each type <span class="RktVar">id</span> implements the operation <span class="RktSym">copy-</span><span class="RktVar">id</span>. This operation is provided for compatibility with views, and has a signature consistent with view-based <span class="RktSym">copy-</span><span class="RktVar">view-id</span> operations. The operation is implemented as a function. The first argument should be the instance being &ldquo;copied,&rdquo; but it is actually ignored. The rest of the arguments are the positional field values for the new object. See <a href="#%28mod-path._magnolisp%2Fast-view%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">magnolisp/ast-view</span></a> for more details on this operation.</p></li><li><p>Each type <span class="RktVar">id</span> also implements the operation <span class="RktSym">set-</span><span class="RktVar">id</span><span class="RktSym">-</span><span class="RktVar">field-name</span> for each of its fields. These operations are functionally updating field setter operations, appropriate for immutable structure types. The signature of the operations is consistent with the operations that views have. Again, see <a href="#%28mod-path._magnolisp%2Fast-view%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">magnolisp/ast-view</span></a> for more details.</p></li></ul></div></p><p><div class="SIntrapara">For example:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">#:none</span><span class="hspace">&nbsp;</span><span class="RktSym">name</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Inc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">#:just</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Add</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">#:many</span><span class="hspace">&nbsp;</span><span class="RktSym">exp-lst</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">Add</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Inc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(Add ((Var x) (Inc (Var y))))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">Var?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">Var=?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">Var=?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">Var-name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'x</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">set-Var-name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">y</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(Var y)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/struct-copy.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct-copy%29%29" class="RktStxLink" data-pltdoc="x">struct-copy</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">y</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(Var y)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">copy-Var</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">y</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(Var y)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">copy-Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">whatever</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">y</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(Var y)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'x</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" class="RktValLink" data-pltdoc="x">syntax-&gt;datum</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fast-serialize..rkt%29._syntactifiable-mkstx%29%29" class="RktValLink" data-pltdoc="x">syntactifiable-mkstx</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(Var 'x)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._all-visitor%29%29" class="RktValLink" data-pltdoc="x">all-visitor</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" class="RktValLink" data-pltdoc="x">displayln</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Add</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Inc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">(Var x)</span></p></td></tr><tr><td><p><span class="RktOut">(Inc (Var y))</span></p></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._magnolisp/ast-repr..rkt)._define-ast*))"></a><span title="Provided from: magnolisp/ast-repr | Package: magnolisp"><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%2A%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-ast*</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">id</span><span class="hspace">&nbsp;</span><span class="RktVar">views</span><span class="hspace">&nbsp;</span><span class="RktVar">fields</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-opts</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A variant of <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span>, such that it also <span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span>s any bindings that it introduces.</div></p><h4>1.1<tt>&nbsp;</tt><a name="(part._.View_.Structure)"></a>View Structure</h4><p>It is possible to enumerate view-based substructure of an AST node, with strategies instantiated using <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._make-view-all%29%29" class="RktStxLink" data-pltdoc="x">make-view-all</a></span>, <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._make-view-some%29%29" class="RktStxLink" data-pltdoc="x">make-view-some</a></span>, and <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._make-view-one%29%29" class="RktStxLink" data-pltdoc="x">make-view-one</a></span>. Instantiation will only succeed for views that have been marked as <span class="RktPn">#:traversable</span>. Instantiated stragies can only be used on nodes that implement their specific view.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._magnolisp/ast-repr..rkt)._make-view-all))"></a><span title="Provided from: magnolisp/ast-repr | Package: magnolisp"><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._make-view-all%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">make-view-all</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">view-id</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Instantiates a <span class="RktVar">view-id</span>-specific variant of the <span class="RktSym">all</span> strategy combinator. See <a href="#%28part._views%29" data-pltdoc="x">AST Node Abstract Interfaces</a> for information about views, and <a href="#%28part._all-some-one%29" data-pltdoc="x">Primitive Strategy Combinators</a> for information about <span class="RktSym">all</span> and other structure-aware strategy combinators.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._magnolisp/ast-repr..rkt)._make-view-some))"></a><span title="Provided from: magnolisp/ast-repr | Package: magnolisp"><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._make-view-some%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">make-view-some</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">view-id</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Instantiates a <span class="RktVar">view-id</span>-specific variant of the <span class="RktSym">some</span> strategy combinator.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._magnolisp/ast-repr..rkt)._make-view-one))"></a><span title="Provided from: magnolisp/ast-repr | Package: magnolisp"><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._make-view-one%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">make-view-one</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">view-id</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Instantiates a <span class="RktVar">view-id</span>-specific variant of the <span class="RktSym">one</span> strategy combinator.</div></p><h3>2<tt>&nbsp;</tt><a name="(part._views)"></a><a name="(mod-path._magnolisp/ast-view)"></a>AST Node Abstract Interfaces</h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._magnolisp%2Fast-view%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">magnolisp/ast-view</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <span class="stt">magnolisp</span></span></td></tr></table></p><p>The <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span> form creates at least one interface for the AST node type being defined, namely the one corresponding to the concrete <span class="RktSym"><a href="http://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" class="RktStxLink" data-pltdoc="x">struct</a></span>ure and its field names. It can also be useful to define additional <span style="font-style: italic">abstract interface</span>s (here called <span style="font-style: italic">view</span>s) that perhaps capture some common structure or semantics shared by a number of different concrete node types. Such interfaces can be defined using the <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%29%29" class="RktStxLink" data-pltdoc="x">define-view</a></span> form. One then merely needs to list the views that each <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span> declared type should implement, and the necessary support code will be automatically added for the concrete node type in question.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._magnolisp/ast-view..rkt)._define-view))"></a><span title="Provided from: magnolisp/ast-view | Package: magnolisp"><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-view</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">id</span><span class="hspace">&nbsp;</span><span class="RktVar">view-spec</span><span class="hspace">&nbsp;</span><span class="RktVar">view-option</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">view-spec</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">field-spec</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktPn">#:fields</span><span class="hspace">&nbsp;</span><span class="RktVar">field-name</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">field-spec</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktPn">#:field</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-qty</span><span class="hspace">&nbsp;</span><span class="RktVar">field-name</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktPn">#:field</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-qty</span><span class="hspace">&nbsp;</span><span class="RktVar">field-name</span><span class="hspace">&nbsp;</span><span class="RktPn">#:use</span><span class="hspace">&nbsp;</span><span class="RktVar">c-field-name</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktPn">#:access</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-qty</span><span class="hspace">&nbsp;</span><span class="RktVar">field-name</span><span class="hspace">&nbsp;</span><span class="RktVar">get-expr</span><span class="hspace">&nbsp;</span><span class="RktVar">set-expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">maybe-qty</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">qty</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">qty</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:none</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:maybe</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:just</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:many</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">view-option</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:also</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">other-view-id</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:partial</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:traversable</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Declares a view named <span class="RktVar">id</span>. Each <span class="RktVar">field-name</span> is an identifier naming one of the abstract fields of the view. The form with the <span class="RktPn">#:fields</span> keyword is shorthand for <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%29%29" class="RktStxLink" data-pltdoc="x">define-view</a></span><span class="stt"> </span><span class="RktVar">id</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">#:field</span><span class="stt"> </span><span class="RktVar">field-name</span><span class="RktPn">]</span><span class="stt"> </span><span class="RktMeta"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span>.</div></p><p>A field specification of the form <span class="RktPn">[</span><span class="RktPn">#:field</span><span class="stt"> </span><span class="RktVar">maybe-qty</span><span class="stt"> </span><span class="RktVar">field-name</span><span class="RktPn">]</span> means that the view should have a field named <span class="RktVar">field-name</span>, implemented so that the field maps directly to a field of the same name in a concrete structure type.</p><p>The <span class="RktPn">#:use</span> variant of the <span class="RktPn">#:field</span> specification may be used to specify a different concrete structure field name <span class="RktVar">c-field-name</span> for a by-name mapping of fields. This can be particularly useful for overrides when using <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span>, if some concrete structure has an unusually named field of compatible semantics.</p><p>A field specification of the form <span class="RktPn">[</span><span class="RktPn">#:access</span><span class="stt"> </span><span class="RktVar">maybe-qty</span><span class="stt"> </span><span class="RktVar">field-name</span><span class="stt"> </span><span class="RktVar">get-expr</span><span class="stt"> </span><span class="RktVar">set-expr</span><span class="RktPn">]</span> means that the view should have a field named <span class="RktVar">field-name</span>, with field access implemented as specified. The expression <span class="RktVar">get-expr</span> specifies a getter function (taking an AST node as an argument, and returning the value of the abstract field), and the expression <span class="RktVar">set-expr</span> specifies a setter function (taking an AST node as the first argument, an abstract field value as the second argument, and returning a modified AST node).</p><p>Where a view is marked as <span class="RktPn">#:traversable</span>, a term quantity value <span class="RktVar">qty</span> must be specified for all of its fields.</p><p>When <span class="RktVar">other-view-id</span>s are declared for a view <span class="RktVar">id</span>, then any concrete node type declared as having the view <span class="RktVar">id</span> will also have the <span class="RktVar">other-view-id</span> views, implemented as originally specified for those views. This is a facility that simulates &ldquo;inheritance&rdquo; between views.</p><p><div class="SIntrapara">The following interfaces and operations are implemented for views:
</div><div class="SIntrapara"><ul><li><p>Each view <span class="RktVar">id</span> gets its own corresponding structure type property <span class="RktSym">prop:</span><span class="RktVar">id</span>. Each AST node type that has said &ldquo;viewpoint&rdquo; sets the property in order to implement the data-type-specific parts of the generic interface of the view.</p></li><li><p>Each view <span class="RktVar">id</span> gets a membership predicate <span class="RktVar">id</span><span class="RktSym">?</span>, which holds for all AST nodes that have the view. A <span class="RktPn">#:partial</span> view may include only a subset of the values of a given concrete node type that implements the view.</p></li><li><p>Each field <span class="RktVar">field-name</span> of the view <span class="RktVar">id</span> will get accessors. The getter is named <span class="RktVar">id</span><span class="RktSym">-</span><span class="RktVar">field-name</span>, and the functional setter is named <span class="RktSym">set-</span><span class="RktVar">id</span><span class="RktSym">-</span><span class="RktVar">field-name</span>.</p></li><li><p>Each view <span class="RktVar">id</span> also gets a function for constructing a different instance of the object being accessed through the view. The function is named <span class="RktSym">copy-</span><span class="RktVar">id</span>, and its signature is <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktVar">id</span><span class="RktSym">?</span><span class="stt"> </span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="stt"> </span><span class="RktMeta"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="stt"> </span><span class="RktVar">id</span><span class="RktSym">?</span><span class="RktPn">)</span>; that is, the function takes an object to functionally modify, new values for the fields of the view (ordered as declared), and returns a new copy of the original object, with the passed abstract view values incorporated into the concrete object.</p></li><li><p>Each view <span class="RktVar">id</span> also gets a comparison function named <span class="RktVar">id</span><span class="RktSym">=?</span>, which compares only the parts of the parent object that correspond to the abstract field values that belong to the view. The comparison of said values is done with <span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span>. Note that only the immediate object comparison is view specific, and any sub-objects of the abstract field values are compared with <span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span>, even if they also implement the same view.</p></li><li><p>Racket&rsquo;s <span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span>ing construct automatically sees to it that any <span class="RktSym"><a href="http://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" class="RktStxLink" data-pltdoc="x">struct</a></span>ure types can be matched against by name; this means that any AST node types defined with <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span> are also <span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span>able. To make views behave in the same way for purposes of matching, every view <span class="RktVar">id</span> also gets a match pattern of the form <span class="RktPn">(</span><span class="RktVar">id</span><span class="stt"> </span><span class="RktVar">pat</span><span class="stt"> </span><span class="RktMeta"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span>, where each <span class="RktVar">pat</span> is a pattern that matches against the corresponding abstract field value. This is implemented by using <span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._define-match-expander%29%29" class="RktStxLink" data-pltdoc="x">define-match-expander</a></span> to define a view-specific <span style="font-style: italic">match expander</span> named <span class="RktVar">id</span>.</p></li><li><p>Each <span class="RktPn">#:traversable</span> view additionally gets the operations <span class="RktVar">id</span><span class="RktSym">-term-fields</span> and <span class="RktSym">set-</span><span class="RktVar">id</span><span class="RktSym">-term-fields</span>. Their semantics are whatever is required by <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._make-view-all%29%29" class="RktStxLink" data-pltdoc="x">make-view-all</a></span>, <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._make-view-some%29%29" class="RktStxLink" data-pltdoc="x">make-view-some</a></span>, and <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._make-view-one%29%29" class="RktStxLink" data-pltdoc="x">make-view-one</a></span>. (In essence, they semantics are the same as for <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._term-fields%29%29" class="RktValLink" data-pltdoc="x">term-fields</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._set-term-fields%29%29" class="RktValLink" data-pltdoc="x">set-term-fields</a></span>, but for the view <span class="RktVar">id</span> rather than for concrete nodes.)</p></li></ul></div></p><p><div class="SIntrapara">For example:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%29%29" class="RktStxLink" data-pltdoc="x">define-view</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Empty</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">Empty</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">yes</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">no</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'no</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%29%29" class="RktStxLink" data-pltdoc="x">define-view</a></span><span class="hspace">&nbsp;</span><span class="RktSym">WithV</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">#:fields</span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">WithV?</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%29%29" class="RktStxLink" data-pltdoc="x">define-view</a></span><span class="hspace">&nbsp;</span><span class="RktSym">WithW</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">#:field</span><span class="hspace">&nbsp;</span><span class="RktSym">w</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">WithW</span><span class="hspace">&nbsp;</span><span class="RktSym">w</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">yes</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">no</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'no</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span><span class="hspace">&nbsp;</span><span class="RktSym">HasVW</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">WithV</span><span class="hspace">&nbsp;</span><span class="RktSym">WithW</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">#:none</span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">#:none</span><span class="hspace">&nbsp;</span><span class="RktSym">w</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vw</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">HasVW</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">WithV-v</span><span class="hspace">&nbsp;</span><span class="RktSym">vw</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">1</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">WithW-w</span><span class="hspace">&nbsp;</span><span class="RktSym">vw</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">2</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vw</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">WithW</span><span class="hspace">&nbsp;</span><span class="RktSym">w</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">w</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">no</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">2</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vw</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">WithW</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._number~3f%29%29" class="RktValLink" data-pltdoc="x">number?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">w</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">w</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">no</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">2</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vw</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">WithV</span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">WithW</span><span class="hspace">&nbsp;</span><span class="RktSym">w</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktSym">w</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">no</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(1 2)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">set-WithV-v</span><span class="hspace">&nbsp;</span><span class="RktSym">vw</span><span class="hspace">&nbsp;</span><span class="RktVal">1/2</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(HasVW 1/2 2)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">copy-WithW</span><span class="hspace">&nbsp;</span><span class="RktSym">vw</span><span class="hspace">&nbsp;</span><span class="RktVal">2/3</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(HasVW 1 2/3)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">WithW=?</span><span class="hspace">&nbsp;</span><span class="RktSym">vw</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">set-WithV-v</span><span class="hspace">&nbsp;</span><span class="RktSym">vw</span><span class="hspace">&nbsp;</span><span class="RktVal">1/2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%29%29" class="RktStxLink" data-pltdoc="x">define-view</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Ast</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">#:field</span><span class="hspace">&nbsp;</span><span class="RktPn">#:none</span><span class="hspace">&nbsp;</span><span class="RktSym">annos</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">get-type</span><span class="hspace">&nbsp;</span><span class="RktSym">ast</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash-ref%29%29" class="RktValLink" data-pltdoc="x">hash-ref</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Ast-annos</span><span class="hspace">&nbsp;</span><span class="RktSym">ast</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">type</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">set-type</span><span class="hspace">&nbsp;</span><span class="RktSym">ast</span><span class="hspace">&nbsp;</span><span class="RktSym">t</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">set-Ast-annos</span><span class="hspace">&nbsp;</span><span class="RktSym">ast</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash-set%29%29" class="RktValLink" data-pltdoc="x">hash-set</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Ast-annos</span><span class="hspace">&nbsp;</span><span class="RktSym">ast</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">type</span><span class="hspace">&nbsp;</span><span class="RktSym">t</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%29%29" class="RktStxLink" data-pltdoc="x">define-view</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Expr</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">#:access</span><span class="hspace">&nbsp;</span><span class="RktPn">#:maybe</span><span class="hspace">&nbsp;</span><span class="RktSym">type</span><span class="hspace">&nbsp;</span><span class="RktSym">get-type</span><span class="hspace">&nbsp;</span><span class="RktSym">set-type</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:also</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Ast</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Expr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">#:none</span><span class="hspace">&nbsp;</span><span class="RktSym">annos</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">#:none</span><span class="hspace">&nbsp;</span><span class="RktSym">dat</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">five</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">#hasheq</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">type</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktVal">int</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">Lit-dat</span><span class="hspace">&nbsp;</span><span class="RktSym">five</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">5</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">Expr-type</span><span class="hspace">&nbsp;</span><span class="RktSym">five</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'int</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">str</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">set-Expr-type</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">set-Lit-dat</span><span class="hspace">&nbsp;</span><span class="RktSym">five</span><span class="hspace">&nbsp;</span><span class="RktVal">"str"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">string</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">str</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Expr</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">string</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym">d</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">d</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">no</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"str"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%29%29" class="RktStxLink" data-pltdoc="x">define-view</a></span><span class="hspace">&nbsp;</span><span class="RktSym">TypeExpr</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%29%29" class="RktStxLink" data-pltdoc="x">define-view</a></span><span class="hspace">&nbsp;</span><span class="RktSym">DefType</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">#:field</span><span class="hspace">&nbsp;</span><span class="RktVar">id</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">#:partial</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ForeignTypeName</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">TypeExpr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">#:none</span><span class="hspace">&nbsp;</span><span class="RktVar">id</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">DefVar-DefType?</span><span class="hspace">&nbsp;</span><span class="RktSym">ast</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">TypeExpr?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">DefVar-val</span><span class="hspace">&nbsp;</span><span class="RktSym">ast</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span><span class="hspace">&nbsp;</span><span class="RktSym">DefVar</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">DefType</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">#:predicate</span><span class="hspace">&nbsp;</span><span class="RktSym">DefVar-DefType?</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">#:none</span><span class="hspace">&nbsp;</span><span class="RktVar">id</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">#:just</span><span class="hspace">&nbsp;</span><span class="RktSym">val</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">DefType?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">DefVar</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="hspace">&nbsp;</span><span class="RktSym">five</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">DefType?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">DefVar</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">Int</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ForeignTypeName</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">long</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">DefType-id</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">DefVar</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">Int</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ForeignTypeName</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">long</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'Int</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._magnolisp/ast-view..rkt)._define-view*))"></a><span title="Provided from: magnolisp/ast-view | Package: magnolisp"><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%2A%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-view*</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">....</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A variant of <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-view..rkt%29._define-view%29%29" class="RktStxLink" data-pltdoc="x">define-view</a></span>, with the same form and semantics, except that it also <span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span>s any top-level bindings that it introduces.</div></p><h3>3<tt>&nbsp;</tt><a name="(part._.A.S.T_.Serialization)"></a><a name="(mod-path._magnolisp/ast-serialize)"></a>AST Serialization</h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._magnolisp%2Fast-serialize%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">magnolisp/ast-serialize</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <span class="stt">magnolisp</span></span></td></tr></table></p><p>It can be useful to be able to persist an AST by storing it in a Racket module as code. The <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span>-defined AST node types support serialization into code, and the same is true for most basic Racket data types that might appear in the <span class="RktPn">#:none</span> fields of nodes.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._magnolisp/ast-serialize..rkt)._gen~3asyntactifiable))"></a><span title="Provided from: magnolisp/ast-serialize | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fast-serialize..rkt%29._gen~3asyntactifiable%29%29" class="RktValDef RktValLink" data-pltdoc="x">gen:syntactifiable</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A <span style="font-style: italic">generic interface</span> for as-Racket-code serializable values. The following method must be implemented:
</div><div class="SIntrapara"><ul><li><p><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fast-serialize..rkt%29._syntactifiable-mkstx%29%29" class="RktValLink" data-pltdoc="x">syntactifiable-mkstx</a></span></p></li></ul></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/ast-serialize..rkt)._syntactifiable~3f))"></a><span title="Provided from: magnolisp/ast-serialize | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fast-serialize..rkt%29._syntactifiable~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">syntactifiable?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A membership predicate associated with the <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fast-serialize..rkt%29._gen~3asyntactifiable%29%29" class="RktValLink" data-pltdoc="x">gen:syntactifiable</a></span> interface. Returns <span class="RktVal">#t</span> if and only if <span class="RktVar">v</span> is a value whose type implements the interface.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/ast-serialize..rkt)._syntactifiable-mkstx))"></a><span title="Provided from: magnolisp/ast-serialize | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fast-serialize..rkt%29._syntactifiable-mkstx%29%29" class="RktValDef RktValLink" data-pltdoc="x">syntactifiable-mkstx</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax~3f%29%29" class="RktValLink" data-pltdoc="x">syntax?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A generic method that returns syntax for code that reconstructs value <span class="RktVar">v</span>, although possibly in a somewhat information-losing way (in that the constructed value is the same to some extent, but not necessarily precisely so). By definition, any value <span class="RktVar">v</span> whose type implements <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fast-serialize..rkt%29._gen~3asyntactifiable%29%29" class="RktValLink" data-pltdoc="x">gen:syntactifiable</a></span> supports this operation. Other supported types are <span class="RktSym"><a href="http://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax~3f%29%29" class="RktValLink" data-pltdoc="x">syntax?</a></span>, <span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._null~3f%29%29" class="RktValLink" data-pltdoc="x">null?</a></span>, <span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._pair~3f%29%29" class="RktValLink" data-pltdoc="x">pair?</a></span>, <span class="RktSym"><a href="http://docs.racket-lang.org/reference/boxes.html#%28def._%28%28quote._~23~25kernel%29._box~3f%29%29" class="RktValLink" data-pltdoc="x">box?</a></span>, <span class="RktSym"><a href="http://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector~3f%29%29" class="RktValLink" data-pltdoc="x">vector?</a></span>, prefab <span class="RktSym"><a href="http://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" class="RktStxLink" data-pltdoc="x">struct</a></span>ure types, <span class="RktSym"><a href="http://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash~3f%29%29" class="RktValLink" data-pltdoc="x">hash?</a></span>, <span class="RktSym"><a href="http://docs.racket-lang.org/reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span>, <span class="RktSym"><a href="http://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._symbol~3f%29%29" class="RktValLink" data-pltdoc="x">symbol?</a></span>, <span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._number~3f%29%29" class="RktValLink" data-pltdoc="x">number?</a></span>, <span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span>, <span class="RktSym"><a href="http://docs.racket-lang.org/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span>, <span class="RktSym"><a href="http://docs.racket-lang.org/reference/characters.html#%28def._%28%28quote._~23~25kernel%29._char~3f%29%29" class="RktValLink" data-pltdoc="x">char?</a></span>, <span class="RktSym"><a href="http://docs.racket-lang.org/reference/keywords.html#%28def._%28%28quote._~23~25kernel%29._keyword~3f%29%29" class="RktValLink" data-pltdoc="x">keyword?</a></span>, <span class="RktSym"><a href="http://docs.racket-lang.org/reference/bytestrings.html#%28def._%28%28quote._~23~25kernel%29._bytes~3f%29%29" class="RktValLink" data-pltdoc="x">bytes?</a></span>, and <span class="RktSym"><a href="http://docs.racket-lang.org/reference/regexp.html#%28def._%28%28quote._~23~25kernel%29._regexp~3f%29%29" class="RktValLink" data-pltdoc="x">regexp?</a></span>.</div></p><p>Any mutability or weakness properties associated with basic collection types are not preserved. For syntax objects, location information and the <span class="RktVal">'</span><span class="RktVal">origin</span> and <span class="RktVal">'</span><span class="RktVal">paren-shape</span> syntax properties are preserved in the serialized form.</p><p><div class="SIntrapara">For example:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Flist%29%29" class="RktStxLink" data-pltdoc="x">for/list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">ast</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">five</span><span class="hspace">&nbsp;</span><span class="RktSym">str</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" class="RktValLink" data-pltdoc="x">syntax-&gt;datum</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fast-serialize..rkt%29._syntactifiable-mkstx%29%29" class="RktValLink" data-pltdoc="x">syntactifiable-mkstx</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ast</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">'((Lit (make-immutable-hasheq (list (cons 'type 'int))) '5)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(Lit (make-immutable-hasheq (list (cons 'type 'string))) '"str"))</span></p></td></tr></table></td></tr></table></blockquote></div></p><h3>4<tt>&nbsp;</tt><a name="(part._.Traversing_and_.Rewriting)"></a><a name="(mod-path._magnolisp/strategy)"></a>Traversing and Rewriting</h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._magnolisp%2Fstrategy%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">magnolisp/strategy</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <span class="stt">magnolisp</span></span></td></tr></table></p><p>To support program analyses and transformations, Illusyn includes a library of operations for generic traversals over ASTs and strategic rewriting of ASTs.</p><h4>4.1<tt>&nbsp;</tt><a name="(part._.Abstraction_over_.Concrete_.Term_.Specifics)"></a>Abstraction over Concrete Term Specifics</h4><p>As we want to implement generic traversals over AST nodes, we want to mostly abstract over the specifics of individual AST node types. This abstraction is defined by the <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._gen~3astrategic%29%29" class="RktValLink" data-pltdoc="x">gen:strategic</a></span> interface;
each AST node being traversed or rewritten is expected to implement it.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._magnolisp/strategy..rkt)._gen~3astrategic))"></a><span title="Provided from: magnolisp/strategy | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._gen~3astrategic%29%29" class="RktValDef RktValLink" data-pltdoc="x">gen:strategic</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A <span style="font-style: italic">generic interface</span> that supplies operations for traversing and rewriting a structure type. The following methods must be implemented:
</div><div class="SIntrapara"><ul><li><p><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._term-visit-all%29%29" class="RktValLink" data-pltdoc="x">term-visit-all</a></span></p></li><li><p><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._term-rewrite-all%29%29" class="RktValLink" data-pltdoc="x">term-rewrite-all</a></span></p></li><li><p><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._term-fields%29%29" class="RktValLink" data-pltdoc="x">term-fields</a></span></p></li><li><p><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._set-term-fields%29%29" class="RktValLink" data-pltdoc="x">set-term-fields</a></span></p></li></ul></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy..rkt)._strategic~3f))"></a><span title="Provided from: magnolisp/strategy | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">strategic?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A membership predicate associated with the <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._gen~3astrategic%29%29" class="RktValLink" data-pltdoc="x">gen:strategic</a></span> interface. Returns <span class="RktVal">#t</span> if and only if <span class="RktVar">v</span> is a value whose type implements the interface.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy..rkt)._term-visit-all))"></a><span title="Provided from: magnolisp/strategy | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._term-visit-all%29%29" class="RktValDef RktValLink" data-pltdoc="x">term-visit-all</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span><span class="RktVar">ast</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%29%29" class="RktStxLink" data-pltdoc="x">any</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ast</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._gen~3astrategic%29%29" class="RktValLink" data-pltdoc="x">gen:strategic</a></span> generic method. Applies function <span class="RktVar">s</span> for its side effects on all the immediate sub-terms of the term <span class="RktVar">ast</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy..rkt)._term-rewrite-all))"></a><span title="Provided from: magnolisp/strategy | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._term-rewrite-all%29%29" class="RktValDef RktValLink" data-pltdoc="x">term-rewrite-all</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span><span class="RktVar">ast</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ast</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._gen~3astrategic%29%29" class="RktValLink" data-pltdoc="x">gen:strategic</a></span> generic method. Applies rewrite rule <span class="RktVar">s</span> to all the immediate sub-terms of the term <span class="RktVar">ast</span>. Returns the rewritten term if the rule applies to all the sub-terms; otherwise returns <span class="RktVal">#f</span>.</div></p><p>Where <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._eq~3f%29%29" class="RktValLink" data-pltdoc="x">eq?</a></span><span class="stt"> </span><span class="RktVar">sub</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVar">s</span><span class="stt"> </span><span class="RktVar">sub</span><span class="RktPn">)</span><span class="RktPn">)</span> holds for all rewritten sub-terms <span class="RktVar">sub</span>, then this function returns its <span class="RktVar">ast</span> argument. This makes it possible to detect whether the term was changed.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy..rkt)._term-fields))"></a><span title="Provided from: magnolisp/strategy | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._term-fields%29%29" class="RktValDef RktValLink" data-pltdoc="x">term-fields</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ast</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._listof%29%29" class="RktValLink" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list~3f%29%29" class="RktValLink" data-pltdoc="x">list?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ast</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._gen~3astrategic%29%29" class="RktValLink" data-pltdoc="x">gen:strategic</a></span> generic method. Returns a list of the values of the potentially sub-term containing fields of term <span class="RktVar">ast</span> (i.e., the fields declared as <span class="RktPn">#:just</span>, <span class="RktPn">#:maybe</span>, or <span class="RktPn">#:many</span>). The fields&rsquo; contents are returned in declaration order.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy..rkt)._set-term-fields))"></a><span title="Provided from: magnolisp/strategy | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._set-term-fields%29%29" class="RktValDef RktValLink" data-pltdoc="x">set-term-fields</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ast</span><span class="hspace">&nbsp;</span><span class="RktVar">lst</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ast</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">lst</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._listof%29%29" class="RktValLink" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list~3f%29%29" class="RktValLink" data-pltdoc="x">list?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">A <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._gen~3astrategic%29%29" class="RktValLink" data-pltdoc="x">gen:strategic</a></span> generic method. Like <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._term-fields%29%29" class="RktValLink" data-pltdoc="x">term-fields</a></span>, but functionally sets the field contents specified by list <span class="RktVar">lst</span> instead of extracting them from the term <span class="RktVar">ast</span>. Returns the modified term.</div></p><h5>4.1.1<tt>&nbsp;</tt><a name="(part._.Lenses)"></a>Lenses</h5><p>A functional <span style="font-style: italic">lens</span> can serve as a composition-friendly abstraction for de- or re-construction of AST nodes (or views). A lens into the term content of a concrete AST node can be instantiated in terms of the <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._term-fields%29%29" class="RktValLink" data-pltdoc="x">term-fields</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._set-term-fields%29%29" class="RktValLink" data-pltdoc="x">set-term-fields</a></span> operations. Similarly named operations are also available for views, enabling lens instantiation for the term content of a given view. Illusyn itself includes no lens abstraction, but third-party APIs for lenses do exist.</p><h4>4.2<tt>&nbsp;</tt><a name="(part._.Visits)"></a>Visits</h4><p>Illusyn includes combinators that build visiting rather than rewriting strategies. In our terminology, a <span style="font-style: italic">visit</span> is a strategy that does not rewrite; it is hence more efficient, as terms do not need to be reconstructed. No return values are checked during a visit, as a visit is only done for its side effects.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy..rkt)._all-visitor))"></a><span title="Provided from: magnolisp/strategy | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._all-visitor%29%29" class="RktValDef RktValLink" data-pltdoc="x">all-visitor</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">A combinator that creates a visiting operation that applies the rule <span class="RktVar">s</span> to all the sub-terms of the term passed to it. No rewriting takes place; the rule is applied only for its side effects.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy..rkt)._topdown-visitor))"></a><span title="Provided from: magnolisp/strategy | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._topdown-visitor%29%29" class="RktValDef RktValLink" data-pltdoc="x">topdown-visitor</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Constructs a strategy that applies the function <span class="RktVar">s</span> depth-first, once per node, to every node in the tree.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy..rkt)._bottomup-visitor))"></a><span title="Provided from: magnolisp/strategy | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._bottomup-visitor%29%29" class="RktValDef RktValLink" data-pltdoc="x">bottomup-visitor</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._topdown-visitor%29%29" class="RktValLink" data-pltdoc="x">topdown-visitor</a></span>, but traverses the tree in bottom-up order.</div></p><h4>4.3<tt>&nbsp;</tt><a name="(part._.Rewriting_.Strategies)"></a><a name="(mod-path._magnolisp/strategy-stratego)"></a>Rewriting Strategies</h4><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left" colspan="2"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._magnolisp%2Fstrategy-stratego%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">magnolisp/strategy-stratego</span></a><span class="RktPn">)</span></td></tr><tr><td align="left">&nbsp;</td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <span class="stt">magnolisp</span></span></td></tr></table></p><p>Illusyn includes a collection of combinators for building rewriting strategies; the API bears a close resemblance to that of <a href="http://strategoxt.org/">Stratego</a>, in part to facilitate fairly direct reuse of strategies appearing in literature.</p><p>A <span style="font-style: italic">strategy</span> is a function that either rewrites an AST (and returns the rewritten AST) or fails at doing so (returning a value indicating failure). The value <span class="RktVal">#f</span> is used to indicate strategy failure.</p><p>For related discussion on Scheme-based implementation of generic
traversal strategies, see Chapter 5 of Pankaj Surana&rsquo;s dissertation&nbsp;(<a href="#%28autobib._.Pankaj._.Surana.Meta-.Compilation._of._.Language._.Abstractions.Ph.D._dissertation%2C._.Northwestern._.University2006%29" data-pltdoc="x">Surana</a> <a href="#%28autobib._.Pankaj._.Surana.Meta-.Compilation._of._.Language._.Abstractions.Ph.D._dissertation%2C._.Northwestern._.University2006%29" data-pltdoc="x">2006</a>).</p><h5>4.3.1<tt>&nbsp;</tt><a name="(part._.Primitive_.Strategies)"></a>Primitive Strategies</h5><p>The most primitive strategies are neither concerned with the structure of concrete terms, nor are they <span style="font-style: italic">strategy combinators</span> (i.e., higher-order strategies that compose more complex strategies out of simpler ones). Such strategies include <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._fail-rw%29%29" class="RktValLink" data-pltdoc="x">fail-rw</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._id-rw%29%29" class="RktValLink" data-pltdoc="x">id-rw</a></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-stratego..rkt)._fail-rw))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._fail-rw%29%29" class="RktValDef RktValLink" data-pltdoc="x">fail-rw</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ast</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ast</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A strategy that always fails.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-stratego..rkt)._id-rw))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._id-rw%29%29" class="RktValDef RktValLink" data-pltdoc="x">id-rw</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ast</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ast</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">The identity strategy. I.e., a strategy that just returns its argument.</div></p><h5>4.3.2<tt>&nbsp;</tt><a name="(part._all-some-one)"></a>Primitive Strategy Combinators</h5><p>Some combinators in the library are concerned with the structure of concrete terms. These are implemented in terms of the <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._gen~3astrategic%29%29" class="RktValLink" data-pltdoc="x">gen:strategic</a></span> generic interface.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-stratego..rkt)._all))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._all%29%29" class="RktValDef RktValLink" data-pltdoc="x">all</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">A combinator that creates a strategy that applies the rule <span class="RktVar">s</span> to all the sub-terms of the term passed to it. The combined strategy fails unless the rule is applicable to all the sub-terms. (If there are no sub-terms, then it succeeds.)</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-stratego..rkt)._some))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._some%29%29" class="RktValDef RktValLink" data-pltdoc="x">some</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">A combinator that creates a strategy that applies the rule <span class="RktVar">s</span> to all the sub-terms of the term passed to it. The combined strategy fails unless the rule is applicable to at least one of the sub-terms.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-stratego..rkt)._one))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._one%29%29" class="RktValDef RktValLink" data-pltdoc="x">one</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">A combinator that creates a strategy that tries to apply the rule <span class="RktVar">s</span> to at least one of the sub-terms of the term passed to it. Only the first sub-term to which <span class="RktVar">s</span> applies is rewritten. The combined strategy fails if <span class="RktVar">s</span> applies to none of the sub-terms.</div></p><h5>4.3.3<tt>&nbsp;</tt><a name="(part._.High-.Level_.Strategy_.Combinators)"></a>High-Level Strategy Combinators</h5><p>Higher-level combinators are no longer concerned with concrete data structures, as they leave such concerns to lower-level strategies that they are combining. Only some of the more commonly used ones are documented here.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._magnolisp/strategy-stratego..rkt)._~3c*))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._~3c%2A%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">&lt;*</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Sequential composition. A macro that builds a strategy that applies the sub-strategies <span class="RktVar">s</span><span class="stt"> </span><span class="RktMeta"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span> in sequence, or fails. Defined as a macro so as to avoid evaluating unneeded argument expressions <span class="RktVar">s</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._magnolisp/strategy-stratego..rkt)._~3c+))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._~3c%2B%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">&lt;+</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Deterministic choice. A macro that builds a strategy that applies the sub-strategies <span class="RktVar">s</span><span class="stt"> </span><span class="RktMeta"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span> in sequence until one of them succeeds. If none succeed, then the overall strategy fails.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._magnolisp/strategy-stratego..rkt)._rec))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._rec%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">rec</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">x</span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Recursive closure. A macro that builds a strategy as given by the expression <span class="RktVar">s</span>, but such that <span class="RktVar">x</span> is bound to the result of the expression <span class="RktVar">s</span> in the scope of the expression <span class="RktVar">s</span>. The expression <span class="RktVar">s</span> is evaluated once.</div></p><p>For example, the expression <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._rec%29%29" class="RktStxLink" data-pltdoc="x">rec</a></span><span class="stt"> </span><span class="RktVar">x</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._~3c%2A%29%29" class="RktStxLink" data-pltdoc="x">&lt;*</a></span><span class="stt"> </span><span class="RktVar">s</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._all%29%29" class="RktValLink" data-pltdoc="x">all</a></span><span class="stt"> </span><span class="RktVar">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span> specifies a top-down traversal strategy.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-stratego..rkt)._try))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._try%29%29" class="RktValDef RktValLink" data-pltdoc="x">try</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">A combinator that constructs a strategy that tries the rewrite rule <span class="RktVar">s</span>, restoring the original term on failure.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-stratego..rkt)._where))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._where%29%29" class="RktValDef RktValLink" data-pltdoc="x">where</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">A combinator that constructs a strategy that tries the rewrite rule <span class="RktVar">s</span>, restoring the original term on success, and failing otherwise.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-stratego..rkt)._when-rw))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._when-rw%29%29" class="RktValDef RktValLink" data-pltdoc="x">when-rw</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">p</span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">p</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">A combinator that constructs a strategy that applies the predicate <span class="RktVar">p</span>, and if it holds, then applies rewrite rule <span class="RktVar">s</span>. If <span class="RktVar">p</span> does not hold, then the original term is retained.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-stratego..rkt)._repeat))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._repeat%29%29" class="RktValDef RktValLink" data-pltdoc="x">repeat</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">A combinator that constructs a strategy that applies rewrite rule <span class="RktVar">s</span> for as many times as it succeeds. Returns the resulting term, which will be the original term if <span class="RktVar">s</span> was not applicable even once.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-stratego..rkt)._topdown))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._topdown%29%29" class="RktValDef RktValLink" data-pltdoc="x">topdown</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>[<span class="RktVar">an-all</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">an-all</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._all%29%29" class="RktValLink" data-pltdoc="x">all</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Constructs a strategy that traverses its argument term top-down (from the root to the leaves), applying rewrite rule <span class="RktVar">s</span> once per node, either until it fails to apply to some node, or until it has been applied to every node in the tree. Traversal is performed as specified by the <span class="RktVar">an-all</span> strategy.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-stratego..rkt)._bottomup))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._bottomup%29%29" class="RktValDef RktValLink" data-pltdoc="x">bottomup</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>[<span class="RktVar">an-all</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">an-all</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._all%29%29" class="RktValLink" data-pltdoc="x">all</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._topdown%29%29" class="RktValLink" data-pltdoc="x">topdown</a></span>, but traverses the tree in bottom-up order (from the
leaves to the root).</div></p><p><div class="SIntrapara">For example:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" class="RktStxLink" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">rw</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._bottomup%29%29" class="RktValLink" data-pltdoc="x">bottomup</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ast</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ast</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">Inc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._number~3f%29%29" class="RktValLink" data-pltdoc="x">number?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ast</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rw</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Inc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Add</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">Inc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Inc</span><span class="hspace">&nbsp;</span><span class="RktSym">five</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">Inc</span><span class="hspace">&nbsp;</span><span class="RktSym">five</span><span class="RktPn">)</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">(Inc (Add ((Lit 7) (Lit 6))))</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-stratego..rkt)._downup))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._downup%29%29" class="RktValDef RktValLink" data-pltdoc="x">downup</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>[<span class="RktVar">an-all</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">an-all</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._all%29%29" class="RktValLink" data-pltdoc="x">all</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A combination of <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._topdown%29%29" class="RktValLink" data-pltdoc="x">topdown</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._bottomup%29%29" class="RktValLink" data-pltdoc="x">bottomup</a></span> such that it applies <span class="RktVar">s</span> both ways of the traversal.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-stratego..rkt)._oncetd))"></a><span title="Provided from: magnolisp/strategy-stratego | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._oncetd%29%29" class="RktValDef RktValLink" data-pltdoc="x">oncetd</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>[<span class="RktVar">a-one</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">a-one</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._one%29%29" class="RktValLink" data-pltdoc="x">one</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Traverses top-down until <span class="RktVar">s</span> successfully applies to a term, or fails if it does not apply to anything. Traversal is performed as specified by the <span class="RktVar">a-one</span> strategy.</div></p><h4>4.4<tt>&nbsp;</tt><a name="(part._.Sub-.Term_.Pruning_.Strategies)"></a><a name="(mod-path._magnolisp/strategy-term)"></a>Sub-Term Pruning Strategies</h4><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._magnolisp%2Fstrategy-term%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">magnolisp/strategy-term</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <span class="stt">magnolisp</span></span></td></tr></table></p><p>Some traversals are such that it is unnecessary to proceed further inside certain sub-terms once they have been encountered, as would happen if using <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._topdown%29%29" class="RktValLink" data-pltdoc="x">topdown</a></span> or <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._topdown-visitor%29%29" class="RktValLink" data-pltdoc="x">topdown-visitor</a></span>. For this reason the library includes <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._topdown-break%29%29" class="RktValLink" data-pltdoc="x">topdown-break</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._topdown-visit-break%29%29" class="RktValLink" data-pltdoc="x">topdown-visit-break</a></span> variants of the above (as inspired by <a href="http://rascal-mpl.org/">Rascal</a>&rsquo;s <span class="RktSym">top-down-break</span><span class="RktMeta"></span> <span class="RktSym">visit</span><span class="RktMeta"></span> expression), during which one can prune sub-term traversals by invoking <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._break%29%29" class="RktStxLink" data-pltdoc="x">break</a></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-term..rkt)._topdown-break))"></a><span title="Provided from: magnolisp/strategy-term | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._topdown-break%29%29" class="RktValDef RktValLink" data-pltdoc="x">topdown-break</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Similar to <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-stratego..rkt%29._topdown%29%29" class="RktValLink" data-pltdoc="x">topdown</a></span>, but allows <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._break%29%29" class="RktStxLink" data-pltdoc="x">break</a></span><span class="stt"> </span><span class="RktVar">expr</span><span class="RktPn">)</span> to appear in the node-rewriting rule <span class="RktVar">s</span>, where <span class="RktVar">expr</span> must evaluate to a value of type <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span>. The evaluation of <span class="RktVar">s</span> stops immediately after any <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._break%29%29" class="RktStxLink" data-pltdoc="x">break</a></span><span class="stt"> </span><span class="RktVar">expr</span><span class="RktPn">)</span>, with an undefined result; if no <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._break%29%29" class="RktStxLink" data-pltdoc="x">break</a></span> gets invoked, then <span class="RktVar">s</span> must evaluate to a value of type <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span> as usual.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._magnolisp/strategy-term..rkt)._topdown-visit-break))"></a><span title="Provided from: magnolisp/strategy-term | Package: magnolisp"><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._topdown-visit-break%29%29" class="RktValDef RktValLink" data-pltdoc="x">topdown-visit-break</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._strategic~3f%29%29" class="RktValLink" data-pltdoc="x">strategic?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Similar to <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy..rkt%29._topdown-visitor%29%29" class="RktValLink" data-pltdoc="x">topdown-visitor</a></span>, but allows <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._break%29%29" class="RktStxLink" data-pltdoc="x">break</a></span><span class="RktPn">)</span> to appear in the node-visiting rule <span class="RktVar">s</span>. The evaluation of <span class="RktVar">s</span> stops immediately after any <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._break%29%29" class="RktStxLink" data-pltdoc="x">break</a></span><span class="RktPn">)</span>, with an undefined result.</div></p><p><div class="SIntrapara">For example:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Dec</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">#:just</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" class="RktStxLink" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">visit</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._topdown-visit-break%29%29" class="RktValLink" data-pltdoc="x">topdown-visit-break</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ast</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._printf%29%29" class="RktValLink" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"visited ~s\n"</span><span class="hspace">&nbsp;</span><span class="RktSym">ast</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._when%29%29" class="RktStxLink" data-pltdoc="x">when</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Inc?</span><span class="hspace">&nbsp;</span><span class="RktSym">ast</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._break%29%29" class="RktStxLink" data-pltdoc="x">break</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">visit</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Dec</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Add</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">Inc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Add</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktRdr">,</span><span class="RktSym">five</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">five</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">Inc</span><span class="hspace">&nbsp;</span><span class="RktSym">five</span><span class="RktPn">)</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">visited (Dec (Add ((Inc (Add ((Lit 5) (Lit 5)))) (Inc (Lit 5)))))</span></p></td></tr><tr><td><p><span class="RktOut">visited (Add ((Inc (Add ((Lit 5) (Lit 5)))) (Inc (Lit 5))))</span></p></td></tr><tr><td><p><span class="RktOut">visited (Inc (Add ((Lit 5) (Lit 5))))</span></p></td></tr><tr><td><p><span class="RktOut">visited (Inc (Lit 5))</span></p></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._magnolisp/strategy-term..rkt)._break))"></a><span title="Provided from: magnolisp/strategy-term | Package: magnolisp"><span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._break%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">break</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-expr</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">maybe-expr</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">expr</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Breaks out of a rewrite/visit rule with the result given by <span class="RktVar">expr</span> as appropriate, without failing the overall strategy (unless <span class="RktVar">expr</span> is given and evaluates to <span class="RktVal">#f</span>). Afterwards the traversal continues so that it does not further descend into the sub-term, but rather continues with any remaining sibling. An&#160;<span class="RktVar">expr</span> must be provided when traversing with <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._topdown-break%29%29" class="RktValLink" data-pltdoc="x">topdown-break</a></span>, and must not be provided when traversing with <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fstrategy-term..rkt%29._topdown-visit-break%29%29" class="RktValLink" data-pltdoc="x">topdown-visit-break</a></span>.</div></p><h3>5<tt>&nbsp;</tt><a name="(part._.Examples)"></a>Examples</h3><p><div class="SIntrapara">Example code demonstrating the use of the Illusyn library can be found in the
Magnolisp source code distribution. Notable files in the distribution include:
</div><div class="SIntrapara"><ul><li><p>The <span class="stt">"ir-ast.rkt"</span> file shows how to define AST node types.
In addition to your typical definitions, it also includes examples of the use
of the <span class="RktPn">#:custom-write</span> and <span class="RktPn">#:singleton</span> options for
<span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span>.</p></li><li><p>The <span class="stt">"parse.rkt"</span> file provides a multitude of examples of the
construction of AST nodes, using constructors defined by <span class="RktSym"><a href="#%28form._%28%28lib._magnolisp%2Fast-repr..rkt%29._define-ast%29%29" class="RktStxLink" data-pltdoc="x">define-ast</a></span>.
Note that the code uses some helper functions defined in the
<span class="stt">"ir-ast.rkt"</span> file in order to preserve location information
found in Racket&rsquo;s native syntax objects.</p></li><li><p>The <span class="stt">"backend-cxx-main.rkt"</span>, <span class="stt">"compiler-api.rkt"</span>,
<span class="stt">"ir-transform.rkt"</span>, and <span class="stt">"type-infer.rkt"</span> files in
particular provide examples of program transformations implemented in terms of
strategic term rewriting, as supported by the
<a href="#%28mod-path._magnolisp%2Fstrategy%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">magnolisp/strategy</span></a> and <a href="#%28mod-path._magnolisp%2Fstrategy-stratego%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">magnolisp/strategy-stratego</span></a> modules&rsquo; API.</p></li><li><p>The <span class="stt">"modbeg.rkt"</span> file demonstrates the use of the <span class="RktSym"><a href="#%28def._%28%28lib._magnolisp%2Fast-serialize..rkt%29._syntactifiable-mkstx%29%29" class="RktValLink" data-pltdoc="x">syntactifiable-mkstx</a></span> generic method, for purposes of exporting information about Magnolisp definitions via a Racket submodule.</p></li></ul></div></p><h3><a name="(part._doc-bibliography)"></a>Bibliography</h3><p><table cellspacing="0" cellpadding="0" class="AutoBibliography"><tr><td><p><a name="(autobib._.Pankaj._.Surana.Meta-.Compilation._of._.Language._.Abstractions.Ph.D._dissertation,._.Northwestern._.University2006)"></a><span class="Autobibentry">Pankaj Surana. Meta-Compilation of Language Abstractions. PhD dissertation, Northwestern University, 2006.</span></p></td></tr><tr><td><p><a name="(autobib._.Eelco._.Visser.Strategic._.Pattern._.Matching.In._.Proc..._.Rewriting._.Techniques._and._.Applications._(.R.T.A'99),._pp..._30--441999)"></a><span class="Autobibentry">Eelco Visser. Strategic Pattern Matching. In <span style="font-style: italic">Proc. Rewriting Techniques and Applications (RTA&rsquo;99)</span>, pp. 30&ndash;44, 1999.</span></p></td></tr></table></p></div></div><div id="contextindicator">&nbsp;</div></body></html>